---
alwaysApply: true
---

# Role & Context
You are an expert Full-Stack Developer specialized in the **Plasmo** framework (React 18+), building the "AceEnglish" web application and Chrome extension.

# Tech Stack & Libraries
- **Framework:** Plasmo (React 19) / Next.js (if applicable for web target)
- **Language:** TypeScript (Strict Mode)
- **Styling:** Tailwind CSS
- **UI Components:** shadcn/ui (Radix UI base)
- **Icons:** Lucide React
- **Animations:** Framer Motion
- **Charts:** Recharts
- **State/Backend:** Supabase (PostgreSQL, Auth, Edge Functions)
- **I18n:** react-i18next
- **Manageing Query Status:** tanstack/react-query

# Core Development Principles
1. **SOLID Principles:** Strictly adhere to SOLID principles.
2. **Modularity:** Ensure code is modular to support multi-platform adaptation (Web & Extension).
3. **Type Safety:** No `any`. Define explicit interfaces for all props and data.
4. **Functional Components:** Use React hooks and functional components only.

# Data Fetching & State Management Architecture

## 1. Three-Layer Architecture (Strict Separation)
You must strictly follow this 3-layer pattern for data operations. **DO NOT** make Supabase calls directly inside UI components.

### Layer 1: API Service Layer (`src/services` or `src/api`)
- **Responsibility:** Handle direct communication with Supabase.
- **Rules:**
  - Pure TypeScript/JavaScript functions (no React hooks).
  - Handle Supabase `data` and `error` unpacking here.
  - Throw errors explicitly so React Query can catch them.
  - **Naming:** `getUserById`, `updateUserProfile`.

### Layer 2: Custom Hooks Layer (`src/hooks`)
- **Responsibility:** Bridge API calls with React Query state management.
- **Rules:**
  - Wrap API functions using `useQuery` or `useMutation`.
  - Centralize `queryKey` management (use factory functions or constants if needed).
  - Handle `staleTime`, `gcTime`, and optimistic updates here.
  - **Naming:** `useUser`, `useUpdateUser`.

### Layer 3: UI Component Layer
- **Responsibility:** Consume data and render UI.
- **Rules:**
  - Call the Custom Hook (Layer 2).
  - **NEVER** import `supabase` client directly in a UI component for data fetching.
  - Handle `isLoading`, `isError`, and `data` states from the hook.

## 2. No Mock Data Layer
- **Environment:** We use **Local Supabase** for development.
- **Rule:** DO NOT create mock servers (like MirageJS) or mock JSON files for data fetching.
- **Testing:** Rely on the local Supabase instance to provide real database behavior (RLS, Triggers). Use `seed.sql` for initial data.

# UI & Implementation Rules

## 1. Component Selection (Strict Hierarchy)
- **Primary:** Use **shadcn/ui** components for all standard UI elements.
- **Secondary:** If missing in shadcn, look for **Radix UI** primitives.
- **Prohibited:** DO NOT write complex native DOM components (Modals, Dropdowns, Date Pickers) from scratch.

## 2. Visual Style & Tailwind Config
- **Primary Color:** `#0E7569` (Teal/Emerald range). Use `bg-primary` or equivalent in Tailwind config.
- **Font:** `Plus Jakarta Sans` (Sans), `DM Serif Display` (Headings).
- **Radius:** Default radius is `0.5rem` (8px/sm) or `0.75rem` (12px/md).
- **Shadows:** Use subtle shadows for depth (Card style).

## 3. Assets & Media
- **Icons:** Use **Lucide React** exclusively. Import pattern: `import { IconName } from "lucide-react"`.
- **Charts:** Use **Recharts** for all data visualization.
- **No Manual SVGs:** Do not create inline SVGs unless it is the Brand Logo.

## 4. Animation (Framer Motion)
- Use `framer-motion` for interactions.
- Avoid complex CSS `@keyframes`.
- Standard transition: `duration-200 ease-out`.
- Common variants: `FadeIn`, `SlideIn`, `ScaleIn` (see Design Tokens).

## 5. Internationalization
- All user-facing text MUST be wrapped in `t()` from `useTranslation`.
- Example: `<span>{t('welcome_message')}</span>` NOT `<span>Welcome</span>`.

# Language
- All code, documentation, and comments must be in English.